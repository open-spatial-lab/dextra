function d(r,e,t){return typeof r===e?()=>r:typeof r=="function"?r:t}class m{constructor(e,{direction:t,elementEnterAction:h,elements:i,focusInIndex:o,isFocusableElement:a,listenerScope:u}={elements:()=>[]}){this._currentIndex=-1,this._direction=()=>"both",this.directionLength=5,this.elementEnterAction=s=>{},this._focused=!1,this._focusInIndex=s=>0,this.isFocusableElement=s=>!0,this._listenerScope=()=>this.host,this.offset=0,this.handleFocusin=s=>{if(!this.isEventWithinListenerScope(s))return;this.isRelatedTargetAnElement(s)&&this.hostContainsFocus();const n=s.composedPath();let c=-1;n.find(l=>(c=this.elements.indexOf(l),c!==-1)),this.currentIndex=c>-1?c:this.currentIndex},this.handleFocusout=s=>{this.isRelatedTargetAnElement(s)&&this.hostNoLongerContainsFocus()},this.handleKeydown=s=>{if(!this.acceptsEventCode(s.code)||s.defaultPrevented)return;let n=0;switch(s.code){case"ArrowRight":n+=1;break;case"ArrowDown":n+=this.direction==="grid"?this.directionLength:1;break;case"ArrowLeft":n-=1;break;case"ArrowUp":n-=this.direction==="grid"?this.directionLength:1;break;case"End":this.currentIndex=0,n-=1;break;case"Home":this.currentIndex=this.elements.length-1,n+=1;break}s.preventDefault(),this.direction==="grid"&&this.currentIndex+n<0?this.currentIndex=0:this.direction==="grid"&&this.currentIndex+n>this.elements.length-1?this.currentIndex=this.elements.length-1:this.setCurrentIndexCircularly(n),this.elementEnterAction(this.elements[this.currentIndex]),this.focus()},this.host=e,this.host.addController(this),this._elements=i,this.isFocusableElement=a||this.isFocusableElement,this._direction=d(t,"string",this._direction),this.elementEnterAction=h||this.elementEnterAction,this._focusInIndex=d(o,"number",this._focusInIndex),this._listenerScope=d(u,"object",this._listenerScope)}get currentIndex(){return this._currentIndex===-1&&(this._currentIndex=this.focusInIndex),this._currentIndex-this.offset}set currentIndex(e){this._currentIndex=e+this.offset}get direction(){return this._direction()}get elements(){return this.cachedElements||(this.cachedElements=this._elements()),this.cachedElements}set focused(e){e!==this.focused&&(this._focused=e)}get focused(){return this._focused}get focusInElement(){return this.elements[this.focusInIndex]}get focusInIndex(){return this._focusInIndex(this.elements)}isEventWithinListenerScope(e){return this._listenerScope()===this.host?!0:e.composedPath().includes(this._listenerScope())}update({elements:e}={elements:()=>[]}){this.unmanage(),this._elements=e,this.clearElementCache(),this.manage()}focus(e){let t=this.elements[this.currentIndex];(!t||!this.isFocusableElement(t))&&(this.setCurrentIndexCircularly(1),t=this.elements[this.currentIndex]),t&&this.isFocusableElement(t)&&t.focus(e)}clearElementCache(e=0){delete this.cachedElements,this.offset=e}setCurrentIndexCircularly(e){const{length:t}=this.elements;let h=t,i=(t+this.currentIndex+e)%t;for(;h&&this.elements[i]&&!this.isFocusableElement(this.elements[i]);)i=(t+i+e)%t,h-=1;this.currentIndex=i}hostContainsFocus(){this.host.addEventListener("focusout",this.handleFocusout),this.host.addEventListener("keydown",this.handleKeydown),this.focused=!0}hostNoLongerContainsFocus(){this.host.addEventListener("focusin",this.handleFocusin),this.host.removeEventListener("focusout",this.handleFocusout),this.host.removeEventListener("keydown",this.handleKeydown),this.currentIndex=this.focusInIndex,this.focused=!1}isRelatedTargetAnElement(e){const t=e.relatedTarget;return!this.elements.includes(t)}acceptsEventCode(e){if(e==="End"||e==="Home")return!0;switch(this.direction){case"horizontal":return e==="ArrowLeft"||e==="ArrowRight";case"vertical":return e==="ArrowUp"||e==="ArrowDown";case"both":case"grid":return e.startsWith("Arrow")}}manage(){this.addEventListeners()}unmanage(){this.removeEventListeners()}addEventListeners(){this.host.addEventListener("focusin",this.handleFocusin)}removeEventListeners(){this.host.removeEventListener("focusin",this.handleFocusin),this.host.removeEventListener("focusout",this.handleFocusout),this.host.removeEventListener("keydown",this.handleKeydown)}hostConnected(){this.addEventListeners()}hostDisconnected(){this.removeEventListeners()}}class f extends m{constructor(){super(...arguments),this.managed=!0,this.manageIndexesAnimationFrame=0}set focused(e){e!==this.focused&&(super.focused=e,this.manageTabindexes())}get focused(){return super.focused}clearElementCache(e=0){cancelAnimationFrame(this.manageIndexesAnimationFrame),super.clearElementCache(e),this.managed&&(this.manageIndexesAnimationFrame=requestAnimationFrame(()=>this.manageTabindexes()))}manageTabindexes(){this.focused?this.updateTabindexes(()=>({tabIndex:-1})):this.updateTabindexes(e=>({removeTabIndex:e.contains(this.focusInElement)&&e!==this.focusInElement,tabIndex:e===this.focusInElement?0:-1}))}updateTabindexes(e){this.elements.forEach(t=>{const{tabIndex:h,removeTabIndex:i}=e(t);if(!i){t.tabIndex=h;return}t.removeAttribute("tabindex");const o=t;o.requestUpdate&&o.requestUpdate()})}manage(){this.managed=!0,this.manageTabindexes(),super.manage()}unmanage(){this.managed=!1,this.updateTabindexes(()=>({tabIndex:0})),super.unmanage()}hostUpdated(){this.host.hasUpdated||this.manageTabindexes()}}export{f as R};
//# sourceMappingURL=RovingTabindex-e989c6f6.js.map
