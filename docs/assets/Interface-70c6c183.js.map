{"version":3,"file":"Interface-70c6c183.js","sources":["../../dextra-components/src/components/Interface/src/Interface.ts"],"sourcesContent":["import { html } from \"lit\";\nimport {  property } from \"lit/decorators.js\";\nimport { ValtioElement } from \"../../core/state\";\nimport { safeCustomElement } from \"../../core/decorators/safeCustomElement\";\nimport { StateSchema } from \"../../core/state/types\";\nimport { interpretFuncJsonOrString } from \"../../core/utils/converters\";\nimport { nonReactiveStore } from \"../../core/state/Store\";\n\nexport type OptionSpec = { value: string | number, label: string | number }\nexport type OptionList = Array<string | number | OptionSpec>\n@safeCustomElement(\"osl-interface\")\nexport class OslControl extends ValtioElement<StateSchema> {\n  @property({ converter: interpretFuncJsonOrString })\n  data = \"\";\n\n  @property({ type: String })\n  option: string = \"\";\n\n  @property()\n  initialValue?: string | number | Array<string | number>;\n\n  @property()\n  value: string | number | Array<string | number> = 1;\n\n  @property({ type: Array })\n  options?: OptionList = [];\n\n  @property({ type: Number })\n  min?: number;\n\n  @property({ type: Number })\n  max?: number;\n\n  @property({ type: Number })\n  step?: number;\n\n  @property({ type: String })\n  type?: string;\n\n  @property({ type: String })\n  label?: string;\n\n  @property({ type: String })\n  placeholder?: string;\n\n  @property({ type: String })\n  description?: string;\n\n  @property({ type: String })\n  unit?: string;\n\n  protected initDataset() {\n    if (!this.data) {\n      return\n    }\n    const datasets = Array.isArray(this.data) ? this.data : [this.data];\n    datasets.forEach((dataset) => {\n      if (!this.store.datasets[dataset] && dataset !== \"\") {\n        this.store.datasets[dataset] = {\n          parameters: {},\n          statuses: {}\n        };\n        nonReactiveStore[dataset] = {}\n      }\n      const currentParams = this.store.datasets[dataset].parameters;\n      if (\n        currentParams[this.option] === undefined &&\n        this.initialValue !== undefined\n      ) {\n        this.value = this.initialValue;\n        this.store.datasets[dataset].parameters[this.option] =\n          this.initialValue;\n      } else {\n        this.value = currentParams[this.option];\n      }\n      this.subscribe(\n        (store) => store.datasets[dataset].parameters,\n        () => {\n          // console.log('params changed')\n          this.value = this.store.datasets[dataset].parameters[this.option];\n          // console.log(this.value)\n          this.domUpdatesOnChange();\n        }\n      )})\n  }\n\n  protected domUpdatesOnChange(){\n    // const value = this.value;\n  }\n\n  getOptionText(option: string | number) {\n    if (!this.options || !this.options.length || typeof this?.options?.[0] !== 'object' ) {\n      return option;\n    } else {\n      const options = this.options as Array<{value:string|number,label:string|number}>\n      const optionSpec = options.find(\n        (optionSpec) => optionSpec.value === option\n      );\n      return optionSpec ? optionSpec.label : option;\n    }\n  }\n\n  protected eventValueAccessor(event: Event) {\n    const target = event.target as HTMLInputElement;\n    return target.value;\n  }\n\n  protected handleChange(event: Event) {\n    const value = this.eventValueAccessor(event);\n    const datasets = Array.isArray(this.data) ? this.data : [this.data];\n    datasets.forEach((dataset) => {\n      this.store.datasets[dataset].parameters[this.option] = value;\n    })\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.initDataset();\n  }\n\n  template() {\n    return html`${this.value}`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"osl-control\": OslControl;\n  }\n}\n"],"names":["OslControl","ValtioElement","dataset","nonReactiveStore","currentParams","store","option","_a","optionSpec","event","value","html","__decorateClass","property","interpretFuncJsonOrString","safeCustomElement"],"mappings":"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"}