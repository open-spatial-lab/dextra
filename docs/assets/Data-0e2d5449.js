import{n as p}from"./safeCustomElement-f1504f3f.js";import{V as K,n as L}from"./ValtioElement-af4c0565.js";import{i as R}from"./converters-40be0569.js";/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var O;const w=window,f=w.trustedTypes,U=f?f.createPolicy("lit-html",{createHTML:h=>h}):void 0,B="$lit$",m=`lit$${(Math.random()+"").slice(9)}$`,Z="?"+m,Q=`<${Z}>`,S=document,D=()=>S.createComment(""),b=h=>h===null||typeof h!="object"&&typeof h!="function",q=Array.isArray,X=h=>q(h)||typeof(h==null?void 0:h[Symbol.iterator])=="function",j=`[ 	
\f\r]`,x=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,F=/-->/g,V=/>/g,v=RegExp(`>|${j}(?:([^\\s"'>=/]+)(${j}*=${j}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),W=/'/g,k=/"/g,G=/^(?:script|style|textarea|title)$/i,Y=h=>(t,...e)=>({_$litType$:h,strings:t,values:e}),P=Y(1),C=Symbol.for("lit-noChange"),$=Symbol.for("lit-nothing"),z=new WeakMap,_=S.createTreeWalker(S,129,null,!1),tt=(h,t)=>{const e=h.length-1,s=[];let i,n=t===2?"<svg>":"",o=x;for(let r=0;r<e;r++){const l=h[r];let A,a,d=-1,y=0;for(;y<l.length&&(o.lastIndex=y,a=o.exec(l),a!==null);)y=o.lastIndex,o===x?a[1]==="!--"?o=F:a[1]!==void 0?o=V:a[2]!==void 0?(G.test(a[2])&&(i=RegExp("</"+a[2],"g")),o=v):a[3]!==void 0&&(o=v):o===v?a[0]===">"?(o=i??x,d=-1):a[1]===void 0?d=-2:(d=o.lastIndex-a[2].length,A=a[1],o=a[3]===void 0?v:a[3]==='"'?k:W):o===k||o===W?o=v:o===F||o===V?o=x:(o=v,i=void 0);const T=o===v&&h[r+1].startsWith("/>")?" ":"";n+=o===x?l+Q:d>=0?(s.push(A),l.slice(0,d)+B+l.slice(d)+m+T):l+m+(d===-2?(s.push(void 0),r):T)}const g=n+(h[e]||"<?>")+(t===2?"</svg>":"");if(!Array.isArray(h)||!h.hasOwnProperty("raw"))throw Error("invalid template strings array");return[U!==void 0?U.createHTML(g):g,s]};class N{constructor({strings:t,_$litType$:e},s){let i;this.parts=[];let n=0,o=0;const g=t.length-1,r=this.parts,[l,A]=tt(t,e);if(this.el=N.createElement(l,s),_.currentNode=this.el.content,e===2){const a=this.el.content,d=a.firstChild;d.remove(),a.append(...d.childNodes)}for(;(i=_.nextNode())!==null&&r.length<g;){if(i.nodeType===1){if(i.hasAttributes()){const a=[];for(const d of i.getAttributeNames())if(d.endsWith(B)||d.startsWith(m)){const y=A[o++];if(a.push(d),y!==void 0){const T=i.getAttribute(y.toLowerCase()+B).split(m),I=/([.?@])?(.*)/.exec(y);r.push({type:1,index:n,name:I[2],strings:T,ctor:I[1]==="."?st:I[1]==="?"?ot:I[1]==="@"?nt:E})}else r.push({type:6,index:n})}for(const d of a)i.removeAttribute(d)}if(G.test(i.tagName)){const a=i.textContent.split(m),d=a.length-1;if(d>0){i.textContent=f?f.emptyScript:"";for(let y=0;y<d;y++)i.append(a[y],D()),_.nextNode(),r.push({type:2,index:++n});i.append(a[d],D())}}}else if(i.nodeType===8)if(i.data===Z)r.push({type:2,index:n});else{let a=-1;for(;(a=i.data.indexOf(m,a+1))!==-1;)r.push({type:7,index:n}),a+=m.length-1}n++}}static createElement(t,e){const s=S.createElement("template");return s.innerHTML=t,s}}function H(h,t,e=h,s){var i,n,o,g;if(t===C)return t;let r=s!==void 0?(i=e._$Co)===null||i===void 0?void 0:i[s]:e._$Cl;const l=b(t)?void 0:t._$litDirective$;return(r==null?void 0:r.constructor)!==l&&((n=r==null?void 0:r._$AO)===null||n===void 0||n.call(r,!1),l===void 0?r=void 0:(r=new l(h),r._$AT(h,e,s)),s!==void 0?((o=(g=e)._$Co)!==null&&o!==void 0?o:g._$Co=[])[s]=r:e._$Cl=r),r!==void 0&&(t=H(h,r._$AS(h,t.values),r,s)),t}class et{constructor(t,e){this.u=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}v(t){var e;const{el:{content:s},parts:i}=this._$AD,n=((e=t==null?void 0:t.creationScope)!==null&&e!==void 0?e:S).importNode(s,!0);_.currentNode=n;let o=_.nextNode(),g=0,r=0,l=i[0];for(;l!==void 0;){if(g===l.index){let A;l.type===2?A=new M(o,o.nextSibling,this,t):l.type===1?A=new l.ctor(o,l.name,l.strings,this,t):l.type===6&&(A=new rt(o,this,t)),this.u.push(A),l=i[++r]}g!==(l==null?void 0:l.index)&&(o=_.nextNode(),g++)}return n}p(t){let e=0;for(const s of this.u)s!==void 0&&(s.strings!==void 0?(s._$AI(t,s,e),e+=s.strings.length-2):s._$AI(t[e])),e++}}class M{constructor(t,e,s,i){var n;this.type=2,this._$AH=$,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=s,this.options=i,this._$Cm=(n=i==null?void 0:i.isConnected)===null||n===void 0||n}get _$AU(){var t,e;return(e=(t=this._$AM)===null||t===void 0?void 0:t._$AU)!==null&&e!==void 0?e:this._$Cm}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=H(this,t,e),b(t)?t===$||t==null||t===""?(this._$AH!==$&&this._$AR(),this._$AH=$):t!==this._$AH&&t!==C&&this.g(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):X(t)?this.k(t):this.g(t)}S(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.S(t))}g(t){this._$AH!==$&&b(this._$AH)?this._$AA.nextSibling.data=t:this.T(S.createTextNode(t)),this._$AH=t}$(t){var e;const{values:s,_$litType$:i}=t,n=typeof i=="number"?this._$AC(t):(i.el===void 0&&(i.el=N.createElement(i.h,this.options)),i);if(((e=this._$AH)===null||e===void 0?void 0:e._$AD)===n)this._$AH.p(s);else{const o=new et(n,this),g=o.v(this.options);o.p(s),this.T(g),this._$AH=o}}_$AC(t){let e=z.get(t.strings);return e===void 0&&z.set(t.strings,e=new N(t)),e}k(t){q(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let s,i=0;for(const n of t)i===e.length?e.push(s=new M(this.S(D()),this.S(D()),this,this.options)):s=e[i],s._$AI(n),i++;i<e.length&&(this._$AR(s&&s._$AB.nextSibling,i),e.length=i)}_$AR(t=this._$AA.nextSibling,e){var s;for((s=this._$AP)===null||s===void 0||s.call(this,!1,!0,e);t&&t!==this._$AB;){const i=t.nextSibling;t.remove(),t=i}}setConnected(t){var e;this._$AM===void 0&&(this._$Cm=t,(e=this._$AP)===null||e===void 0||e.call(this,t))}}class E{constructor(t,e,s,i,n){this.type=1,this._$AH=$,this._$AN=void 0,this.element=t,this.name=e,this._$AM=i,this.options=n,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=$}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,e=this,s,i){const n=this.strings;let o=!1;if(n===void 0)t=H(this,t,e,0),o=!b(t)||t!==this._$AH&&t!==C,o&&(this._$AH=t);else{const g=t;let r,l;for(t=n[0],r=0;r<n.length-1;r++)l=H(this,g[s+r],e,r),l===C&&(l=this._$AH[r]),o||(o=!b(l)||l!==this._$AH[r]),l===$?t=$:t!==$&&(t+=(l??"")+n[r+1]),this._$AH[r]=l}o&&!i&&this.j(t)}j(t){t===$?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class st extends E{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===$?void 0:t}}const it=f?f.emptyScript:"";class ot extends E{constructor(){super(...arguments),this.type=4}j(t){t&&t!==$?this.element.setAttribute(this.name,it):this.element.removeAttribute(this.name)}}class nt extends E{constructor(t,e,s,i,n){super(t,e,s,i,n),this.type=5}_$AI(t,e=this){var s;if((t=(s=H(this,t,e,0))!==null&&s!==void 0?s:$)===C)return;const i=this._$AH,n=t===$&&i!==$||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,o=t!==$&&(i===$||n);n&&this.element.removeEventListener(this.name,this,i),o&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,s;typeof this._$AH=="function"?this._$AH.call((s=(e=this.options)===null||e===void 0?void 0:e.host)!==null&&s!==void 0?s:this.element,t):this._$AH.handleEvent(t)}}class rt{constructor(t,e,s){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(t){H(this,t)}}const J=w.litHtmlPolyfillSupport;J==null||J(N,M),((O=w.litHtmlVersions)!==null&&O!==void 0?O:w.litHtmlVersions=[]).push("2.7.0");const ht={filterUnique:(h,t,e)=>e.indexOf(h)===t};var lt=Object.defineProperty,at=Object.getOwnPropertyDescriptor,c=(h,t,e,s)=>{for(var i=s>1?void 0:s?at(t,e):t,n=h.length-1,o;n>=0;n--)(o=h[n])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&lt(t,e,i),i};class u extends K{constructor(){super(...arguments),this.utils=ht,this.geoColumn="",this.dataColumn="",this.geoType="WKT",this.colorScheme="RdPu",this.type="continuous",this.bins=5,this.option="",this.useGeojsonData=Boolean(this.geoType&&this.geoColumn),this.data="",this.currentResults=[],this.status="pending",this.currentParametersHash="",this.labelFormat="nice",this.onInteractProperty="",this.isReady=!1}getDeepValue(t,e){const s=e.split(".");let i=t;for(;s.length;){const n=s.shift();if(!n)break;i=i[n]}return i}syncDataFromStore(t,e){const s=this.store.datasets[t].statuses,i=JSON.stringify(this.store.datasets[t].parameters),n=e?`${i}/geo/${this.geoColumn}`:i,o=s==null?void 0:s[n];console.log("syncDataFromStore",this.tagName,this.currentParametersHash,n),o==="success"&&this.currentParametersHash!==n?(this.currentResults=L[t][n],this.currentParametersHash=n,this.isReady=!0):o!=="success"&&(this.isReady=!1)}initDataset(t,e){t&&(!this.store.datasets[t]&&t!==""?(this.store.datasets[t]={parameters:{},statuses:{}},L[t]={}):this.syncDataFromStore(t,e),this.subscribe(s=>s.datasets[t].statuses,()=>this.syncDataFromStore(t,e)),this.subscribe(s=>s.datasets[t].parameters,()=>this.syncDataFromStore(t,e)))}eventValueAccessor(t){if(this.onInteractProperty)return t[this.onInteractProperty]}handleChange(t){if(!this.onInteractDataset||!this.option||!this.onInteractProperty)return;const e=this.eventValueAccessor(t);(Array.isArray(this.onInteractDataset)?this.onInteractDataset:[this.onInteractDataset]).forEach(i=>{this.store.datasets[i].parameters[this.option]=e})}connectedCallback(){super.connectedCallback();const t=Boolean(this.geoType&&this.geoColumn);this.data&&this.initDataset(this.data,t),t&&!this.store.geoListeners.find(s=>s.geoColumn===this.geoColumn&&s.geoType===this.geoType&&s.dataset===this.data)&&this.store.geoListeners.push({geoColumn:this.geoColumn,geoType:this.geoType,geoId:this.geoId,dataset:this.data})}template(){return P`<pre>
${JSON.stringify(this.currentResults||[],null,2)}</pre
    >`}preloader(){return this.isReady?P``:P`
      <div
        style="position:absolute;width:100%;height:100%;background:rgba(255,255,255,0.75);z-index:1000;top:0;left:0;display:flex;flex-direction:column;justify-content:center;align-items:center"
      >
        ${super.preloader()}
      </div>
    `}render(){return P`
      <sp-theme scale="" color="light" style="height:100%; width:100%;">
        ${this.preloader()} ${this.template()}
      </sp-theme>
    `}}c([p({type:String})],u.prototype,"geoColumn",2);c([p({type:String})],u.prototype,"dataColumn",2);c([p({type:String})],u.prototype,"geoType",2);c([p({type:String})],u.prototype,"geoId",2);c([p({type:String})],u.prototype,"colorScheme",2);c([p({type:String})],u.prototype,"type",2);c([p({converter:R})],u.prototype,"labels",2);c([p({type:String})],u.prototype,"method",2);c([p({type:Number})],u.prototype,"bins",2);c([p({converter:R})],u.prototype,"manualBreaks",2);c([p({converter:R})],u.prototype,"mapping",2);c([p({type:String})],u.prototype,"option",2);c([p({type:Boolean})],u.prototype,"useGeojsonData",2);c([p({type:String})],u.prototype,"data",2);c([p({type:Array})],u.prototype,"currentResults",2);c([p({type:String})],u.prototype,"status",2);c([p({type:String})],u.prototype,"currentParametersHash",2);c([p({type:String})],u.prototype,"labelFormat",2);c([p({type:String})],u.prototype,"legendTitle",2);c([p({converter:R})],u.prototype,"onInteractDataset",2);c([p({type:String})],u.prototype,"onInteractProperty",2);c([p({type:Boolean})],u.prototype,"isReady",2);export{u as O,P as x};
//# sourceMappingURL=Data-0e2d5449.js.map
